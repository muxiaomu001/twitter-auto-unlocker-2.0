# Twitter Auto Unlocker 2.0 产品需求文档

> **版本**: 2.0 | **更新日期**: 2026-01-20 | **文档类型**: PRD

---

## 1. 产品概述

### 1.1 产品定位

**产品名称**: Twitter Auto Unlocker 2.0

**产品形态**: 命令行工具（CLI）

**核心目标**: 批量自动解锁被 Twitter/X 限制的账号

### 1.2 目标用户

需要批量管理 Twitter 账号的运营人员，具备以下特点：
- 拥有大量 Twitter 账号
- 部分账号因各种原因被限制（需要验证才能继续使用）
- 需要自动化工具批量处理解锁流程

---

## 2. 功能需求清单

### 2.1 MVP 必须功能

| 功能 | 说明 |
|------|------|
| ✅ 批量账号解锁 | 一次处理多个账号，支持并发 3-10 个浏览器同时工作 |
| ✅ Token 优先登录 | 优先使用账号的 auth_token 直接登录，跳过密码输入环节 |
| ✅ 账号密码登录 | Token 失败或不存在时，自动降级为账号密码登录 |
| ✅ 自动 2FA 验证 | 自动生成并输入 TOTP 验证码 |
| ✅ 验证码自动处理 | 自动处理 Cloudflare Turnstile 和 Arkose FunCaptcha |
| ✅ 身份验证处理 | 遇到"异常活动验证"时，自动填写邮箱/用户名 |
| ✅ 解锁后导出 cookies | 成功解锁后自动保存账号的 cookies 文件 |
| ✅ 多格式账号支持 | 支持 1/2/3/4/8 字段的账号格式 |
| ✅ 结果统计输出 | 输出成功/失败账号列表和汇总报告 |

### 2.2 非目标（不做）

| 功能 | 说明 |
|------|------|
| ❌ API 集成模式 | 不提供 API 供其他系统调用（V2 考虑） |
| ❌ 图形界面 | 仅支持命令行操作 |
| ❌ 账号注册功能 | 只做解锁，不做注册 |
| ❌ 手动验证码输入 | 验证码必须自动处理，不支持人工介入 |

---

## 3. 账号格式规范

### 3.1 支持的输入格式

用户需要准备一个文本文件（如 `accounts.txt`），每行一个账号，使用冒号 `:` 分隔字段。

| 格式 | 字段数 | 示例 | 说明 |
|------|--------|------|------|
| 仅 Token | 1 | `7d449909ff9e88cc6ffa96959b920d702fc7af52` | 纯 Token 登录 |
| 账号:密码 | 2 | `username:password123` | 基础登录 |
| 账号:密码:2FA | 3 | `username:password123:TOTP_SECRET` | 带 2FA 验证 |
| 账号:密码:邮箱:2FA | 4 | `username:password:user@email.com:TOTP` | 带邮箱验证 |
| 完整格式 | 8 | 见下方 | 包含所有字段 |

**完整格式（8字段）**：
```
账号:密码:2FA:token:邮箱:邮箱密码:邮箱ClientId:邮箱RefreshToken
```

### 3.2 字段说明

| 字段 | 必填 | 说明 |
|------|------|------|
| 账号 | 条件 | Twitter 用户名（Token 登录时可省略） |
| 密码 | 条件 | 账号密码（Token 登录时可省略） |
| 2FA | 否 | TOTP 密钥，用于自动生成验证码 |
| token | 否 | Twitter auth_token，优先使用 |
| 邮箱 | 否 | 关联邮箱，用于身份验证 |
| 邮箱密码 | 否 | 邮箱密码（预留） |
| 邮箱ClientId | 否 | 邮箱 OAuth（预留） |
| 邮箱RefreshToken | 否 | 邮箱 OAuth（预留） |

---

## 4. 核心流程说明

### 4.1 登录流程

```
┌─────────────────────────────────────────────────────────────┐
│                        登录流程                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 检查账号是否有 Token                                      │
│     │                                                        │
│     ├─ 有 Token ────────────────────────────────────────────┤
│     │      │                                                 │
│     │      ▼                                                 │
│     │  2. 尝试 Token 登录                                    │
│     │     （设置 auth_token Cookie，访问 Twitter）             │
│     │      │                                                 │
│     │      ├─ 成功 → 检查账号状态                             │
│     │      │         ├─ 正常 → 结束（无需解锁）               │
│     │      │         └─ 需要解锁 → 进入解锁流程               │
│     │      │                                                 │
│     │      └─ 失败 → 检查是否有密码                          │
│     │               ├─ 有密码 → 降级到账号密码登录            │
│     │               └─ 无密码 → 报告失败                     │
│     │                                                        │
│     └─ 无 Token ────────────────────────────────────────────┤
│            │                                                 │
│            ▼                                                 │
│  3. 账号密码登录                                              │
│     │                                                        │
│     ▼                                                        │
│  4. 输入用户名 ────────────────────────────────────────────── │
│     │                                                        │
│     ├─ 风控拦截 → 直接失败（无法继续）                        │
│     │                                                        │
│     ├─ 需要身份验证 → 填写邮箱/用户名 → 继续                  │
│     │                                                        │
│     └─ 正常 → 继续                                           │
│            │                                                 │
│            ▼                                                 │
│  5. 输入密码                                                  │
│     │                                                        │
│     ▼                                                        │
│  6. 检查是否需要 2FA                                          │
│     │                                                        │
│     ├─ 需要 → 自动生成并输入 TOTP 验证码                      │
│     │                                                        │
│     └─ 不需要 → 继续                                         │
│            │                                                 │
│            ▼                                                 │
│  7. 登录完成，检查账号状态                                     │
│     │                                                        │
│     ├─ 正常 → 结束                                           │
│     └─ 需要解锁 → 进入解锁流程                               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 解锁流程

```
┌─────────────────────────────────────────────────────────────┐
│                        解锁流程                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 导航到解锁页面                                            │
│     URL: https://x.com/account/access                       │
│     │                                                        │
│     ▼                                                        │
│  2. 点击 "Start" 按钮                                        │
│     │                                                        │
│     ├─ 页面无变化 → 重试点击（最多 3 次）                     │
│     │                                                        │
│     └─ 页面变化 → 继续                                       │
│            │                                                 │
│            ▼                                                 │
│  3. 等待验证码出现                                            │
│     │                                                        │
│     ├─ Cloudflare Turnstile 验证码                          │
│     │   → 等待插件自动处理                                   │
│     │   → 检测验证码消失后继续                               │
│     │                                                        │
│     ├─ Arkose FunCaptcha 验证码                             │
│     │   → 等待插件自动处理                                   │
│     │   → 检测验证码消失后继续                               │
│     │                                                        │
│     └─ 无验证码 → 继续                                       │
│            │                                                 │
│            ▼                                                 │
│  4. 验证解锁结果                                              │
│     │                                                        │
│     ├─ 成功（跳转到首页或提示成功）                           │
│     │   → 保存 cookies                                       │
│     │   → 记录成功                                           │
│     │                                                        │
│     └─ 失败                                                  │
│         → 记录失败原因                                       │
│         → 检查是否需要重试                                   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 异常处理

#### 4.3.1 风控拦截处理

**触发场景**：Twitter 检测到自动化行为

**表现**：
- 页面显示"无法完成操作"
- 无法继续输入任何内容

**处理方式**：
- 直接标记为失败
- 记录失败原因："风控拦截"
- 不进行重试（重试也会失败）

#### 4.3.2 身份验证处理

**触发场景**：Twitter 检测到可疑行为，要求验证身份

**表现**：
- 页面标题："Verify your identity"
- 提示："Enter your email address to verify that it's you"

**处理方式**：
1. 检测到身份验证页面
2. 从账号信息中获取邮箱或用户名
3. 自动填写到输入框
4. 继续登录流程

#### 4.3.3 验证码处理

**支持的验证码类型**：

| 类型 | 出现位置 | 处理方式 |
|------|----------|----------|
| Cloudflare Turnstile | 登录页面、2FA 验证后 | 等待插件自动处理 |
| Arkose FunCaptcha | 解锁页面 | 等待插件自动处理 |

**处理流程**：
1. 检测验证码 iframe 是否出现
2. 如果出现，等待 YesCaptcha 插件自动处理
3. 持续检测验证码 iframe 是否消失
4. 消失后继续下一步操作
5. 超时（120秒）则标记失败

---

## 5. 验证码处理规范

### 5.1 处理模式

**插件模式（推荐）**：
- 在浏览器中预装 YesCaptcha 人机助手插件
- 插件自动识别并处理所有类型验证码
- 代码只需等待验证码消失

**API 模式（备用）**：
- 使用 YesCaptcha API 进行图像识别
- 代码截取验证码图片，发送到 API，获取答案，模拟点击
- 仅用于 FunCaptcha 图像选择类验证码

### 5.2 验证码等待逻辑

1. **检测验证码出现**：检查页面是否存在验证码 iframe
2. **等待处理完成**：持续检查验证码 iframe 是否消失
3. **超时处理**：超过最大等待时间（120秒）则标记失败
4. **重试机制**：失败后可重试整个流程（最多 3 次）

---

## 6. 输入输出规范

### 6.1 输入

| 类型 | 文件 | 格式 | 说明 |
|------|------|------|------|
| 账号文件 | `accounts.txt` | 文本，每行一个账号 | 必须 |
| 配置文件 | `config.yaml` | YAML | 可选 |

**配置项**：
- `captcha.api_key`：YesCaptcha API Key
- `browser.api_url`：BitBrowser API 地址
- `concurrency.max_browsers`：最大并发数
- `retry.max_attempts`：最大重试次数
- `output.dir`：输出目录

### 6.2 输出

| 类型 | 文件 | 说明 |
|------|------|------|
| 成功列表 | `output/success.txt` | 成功解锁的账号列表 |
| 失败列表 | `output/failed.txt` | 失败的账号列表 |
| 汇总报告 | `output/summary.txt` | 处理结果统计 |
| Cookies | `output/{账号}/cookies.json` | 每个成功账号的 cookies |
| 截图 | `output/{账号}/screenshot_*.png` | 关键步骤截图 |

---

## 7. 约束条件

### 7.1 硬性约束

| 约束 | 说明 | 原因 |
|------|------|------|
| 必须使用代理 | 每个账号必须通过代理访问 | 运行环境无法直连 Twitter |
| 独立浏览器指纹 | 每个浏览器实例必须有独立指纹 | 避免被 Twitter 关联检测 |
| 使用 BitBrowser | 必须使用比特浏览器 | 支持指纹管理和 API 控制 |
| 验证码自动处理 | 验证码必须通过插件自动处理 | 不支持人工介入 |

### 7.2 性能约束

| 约束 | 数值 | 说明 |
|------|------|------|
| 最大并发数 | 3-10 | 同时运行的浏览器数量 |
| 单账号超时 | 5 分钟 | 超过则标记失败 |
| 验证码超时 | 120 秒 | 等待验证码处理的最大时间 |
| 最大重试次数 | 3 次 | 每个账号的重试上限 |

---

## 8. 验收标准

### 8.1 功能验收

| 功能 | 验收标准 |
|------|----------|
| Token 登录 | 提供 Token 的账号能成功登录，无需输入密码 |
| Token 降级 | Token 失败时自动使用账号密码登录 |
| 2FA 验证 | 自动生成并输入正确的 TOTP 验证码 |
| 身份验证 | 遇到身份验证时能自动填写邮箱 |
| 验证码处理 | 所有验证码能被自动处理，无需人工介入 |
| 并发处理 | 能同时处理多个账号，不会相互干扰 |
| 结果导出 | 成功账号的 cookies 能正确导出 |
| 统计报告 | 处理完成后输出准确的统计信息 |

### 8.2 异常验收

| 场景 | 预期行为 |
|------|----------|
| 账号不存在 | 标记失败，原因："账号不存在" |
| 密码错误 | 标记失败，原因："密码错误" |
| 风控拦截 | 标记失败，原因："风控拦截"，不重试 |
| 验证码超时 | 标记失败，原因："验证码超时" |
| 网络错误 | 重试，超过次数后标记失败 |
| 浏览器崩溃 | 记录错误，继续处理下一个账号 |

---

## 9. 使用示例

### 9.1 基本用法

```bash
# 使用配置文件
python main.py --input accounts.txt --config config.yaml

# 指定参数
python main.py --input accounts.txt --api-key YOUR_KEY --concurrency 5
```

### 9.2 账号文件示例

```
# 仅 Token 登录
7d449909ff9e88cc6ffa96959b920d702fc7af52

# 账号密码登录
hugo_hughes_:mypassword123

# 带 2FA
hugo_hughes_:mypassword123:JBSWY3DPEHPK3PXP

# 完整格式
hugo_hughes_:mypassword123:TOTP:7d449909ff:hugo@email.com:::
```

---

**文档结束**
